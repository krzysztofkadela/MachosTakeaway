{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% url 'account_login' as login_url %}
{% url 'account_signup' as signup_url %}
{% url 'account_logout' as logout_url %}

{% block content %}
<!-- comment section -->
<!-- client section for last 10 approved comments -->
<section class="client_section layout_padding-bottom">
  <div class="container">
    <div class="heading_container heading_center psudo_white_primary mb_45">
      <h2>
        We hope you have a nice experience..
      </h2>
    </div>

    <form method="POST" class="mb-4">
      {% csrf_token %}
      {{ form|crispy }}
      <button type="submit" class="btn custom_button">Submit Comment</button>
    </form>
    
    <div class="carousel-wrap row ">
      <div class="owl-carousel client_owl-carousel">
        {% for comment in comments %}
        <div class="item">
          <div class="box">
            <div class="detail-box">
              <p>
                {{ comment.comment }}
              </p>
              <h6>
                {{ comment.user.username }}
              </h6>
              <p>
                {{ comment.comment_date|date:"F d, Y" }}
              </p>
              <p>
                <strong>Status:</strong> {% if comment.is_approved %}Approved{% else %}Pending{% endif %}
              </p>
              
              <!-- Edit Button -->
              {% if comment.user == user %}  <!-- Allow only the author to edit -->
              <button class="btn custom_button" 
                      onclick="toggleEditForm('{{ comment.id }}')">Edit</button>
              {% endif %}

              <!-- Delete Button (still needs functionality) -->
                <button type="submit" class="btn btn-danger">Delete</button>
            </div>
            <div class="img-box">
              <img src="{% static 'images/client1.jpg' %}" alt="" class="box-img">
            </div>
          </div>
        </div>

        <!-- Edit Form (initially hidden) -->
        <div id="editForm-{{ comment.id }}" class="edit-comment-form" style="display:none;">
          <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="comment_id" value="{{ comment.id }}">
            <textarea name="comment" class="form-control">{{ comment.comment }}</textarea>
            <button type="submit" class="btn custom_button">Update Comment</button>
            <button type="button" class="btn btn-secondary" onclick="toggleEditForm('{{ comment.id }}')">Cancel</button>
          </form>
        </div>

        {% endfor %}
      </div>
    </div>
  </div>
</section>
<!-- end comment section -->

<script>
function toggleEditForm(commentId) {
  const editForm = document.getElementById(`editForm-${commentId}`);
  // Toggle visibility
  if (editForm.style.display === 'none') {
    editForm.style.display = 'block';
  } else {
    editForm.style.display = 'none';
  }
}
</script>

{% endblock %}